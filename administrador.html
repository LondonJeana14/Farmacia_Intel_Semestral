<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administraci√≥n</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link href="css/admin.css" rel="stylesheet">
</head>
<body>
    <!-- Header de Admin -->

    <div class="admin-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1>üè• Panel de Administraci√≥n</h1>
                    <p class="mb-0" id="infoUsuario">Cargando...</p>
                    <p class="mb-0" id="horaServidor">Hora del servidor: --:--:--</p>
                </div>
                
                <div class="col-md-4 text-end">
                    <button class="btn btn-light" onclick="cerrarSesion()">
                        üö™ Cerrar Sesi√≥n
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Tabs de navegaci√≥n -->
        <ul class="nav nav-tabs mb-4" id="adminTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="medicamentos-tab" data-bs-toggle="tab" 
                        data-bs-target="#medicamentos" type="button">
                    üíä Medicamentos
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="prediccion-tab" data-bs-toggle="tab" 
                        data-bs-target="#prediccion" type="button">
                    üìä Predicci√≥n de Ventas
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="vencimientos-tab" data-bs-toggle="tab" 
                        data-bs-target="#vencimientos" type="button">
                    ‚ö†Ô∏è Vencimientos
                </button>
            </li>
        </ul>

        <!-- Contenido de Tabs -->
        <div class="tab-content" id="adminTabsContent">
            <!-- TAB: MEDICAMENTOS -->
            <div class="tab-pane fade show active" id="medicamentos">
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">‚ûï Agregar Nuevo Medicamento</h5>
                    </div>
                    <div class="card-body">
                        <div id="mensaje" class="mb-3"></div>
                        <form id="formMedicamento" onsubmit="crearMedicamento(event)">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Nombre *</label>
                                    <input type="text" id="nombre" class="form-control" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Imagen del Medicamento</label>
                                    <input type="file" id="imagen" class="form-control" 
                                           accept="image/png, image/jpeg, image/jpg, image/webp"
                                           onchange="previsualizarImagen(event)">
                                    <small class="text-muted">Formatos: JPG, PNG, WEBP (m√°x. 2MB)</small>
                                </div>
                            </div>
                            <div class="row" id="previewContainer" style="display: none;">
                                <div class="col-12 mb-3">
                                    <div class="text-center">
                                        <img id="imagePreview" src="" alt="Vista previa" 
                                             class="preview-image">
                                        <br>
                                        <button type="button" class="btn btn-sm btn-danger mt-2" onclick="limpiarImagen()">
                                            ‚ùå Quitar imagen
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Cantidad *</label>
                                    <input type="number" id="cantidad" class="form-control" min="0" required>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Precio *</label>
                                    <input type="number" id="precio" class="form-control" 
                                           step="0.01" min="0" required>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Fecha Vencimiento</label>
                                    <input type="date" id="fechaVencimiento" class="form-control">
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary" id="btnGuardar">
                                Guardar Medicamento
                            </button>
                        </form>
                    </div>
                </div>

                <h4>üìã Lista de Medicamentos</h4>
                <div id="listaMedicamentos" class="row">
                    <div class="col-12 text-center">
                        <p>Cargando medicamentos...</p>
                    </div>
                </div>
            </div>

            <!-- TAB: PREDICCI√ìN -->
            <div class="tab-pane fade" id="prediccion">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">üìä Predicci√≥n de Ventas por Medicamento</h5>
                    </div>
                    <div class="card-body">
                        <div id="listaPredicciones">
                            <p class="text-center">Cargando predicciones...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB: VENCIMIENTOS -->
            <div class="tab-pane fade" id="vencimientos">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card mb-4">
                            <div class="card-header bg-danger text-white">
                                <h5 class="mb-0">‚ùå Medicamentos Vencidos</h5>
                            </div>
                            <div class="card-body" id="medicamentosVencidos">
                                <p class="text-center">Cargando...</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card mb-4">
                            <div class="card-header bg-warning text-dark">
                                <h5 class="mb-0">‚ö†Ô∏è Por Vencer (30 d√≠as)</h5>
                            </div>
                            <div class="card-body" id="medicamentosPorVencer">
                                <p class="text-center">Cargando...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL PARA EDITAR MEDICAMENTO -->
    <div class="modal fade" id="modalEditar" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-warning">
                    <h5 class="modal-title">‚úèÔ∏è Editar Medicamento</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="mensajeModal" class="mb-3"></div>
                    <form id="formEditar" onsubmit="guardarEdicion(event)">
                        <input type="hidden" id="editId">
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nombre *</label>
                                <input type="text" id="editNombre" class="form-control" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nueva Imagen (opcional)</label>
                                <input type="file" id="editImagen" class="form-control" 
                                       accept="image/png, image/jpeg, image/jpg, image/webp"
                                       onchange="previsualizarImagenEditar(event)">
                            </div>
                        </div>

                        <div class="row" id="previewContainerEdit" style="display: none;">
                            <div class="col-12 mb-3">
                                <div class="text-center">
                                    <img id="imagePreviewEdit" src="" alt="Vista previa" 
                                         class="preview-image">
                                    <br>
                                    <button type="button" class="btn btn-sm btn-danger mt-2" 
                                            onclick="limpiarImagenEditar()">
                                        ‚ùå Quitar nueva imagen
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Cantidad *</label>
                                <input type="number" id="editCantidad" class="form-control" min="0" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Precio *</label>
                                <input type="number" id="editPrecio" class="form-control" 
                                       step="0.01" min="0" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Fecha Vencimiento</label>
                                <input type="date" id="editFechaVencimiento" class="form-control">
                            </div>
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                Cancelar
                            </button>
                            <button type="submit" class="btn btn-warning" id="btnActualizar">
                                Actualizar Medicamento
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
 <audio controls autoplay loop hidden>
                <source src="audio/„Äåüåô Relaxing night ambience & musicüåô„Äç  ‚ô°Kagome & Inuyasha go on a peaceful bike ride together‚ô° - melusinebb.mp3" type="audio/mpeg">
            </audio>
 <footer id="footer">
        <p>&copy; 2025 Farmacia La Felicidad</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/soluciones.js"></script>
    <script src="js/admin.js"></script>
</body>
</html>